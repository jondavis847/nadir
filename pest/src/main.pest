WHITESPACE = _{ " " | "\t" | NEWLINE }

primary = _{ enclosed | struct_call | instance_call | instance_field | function_call | vector | matrix | identifier | number }
unary = { neg* ~ primary }
neg = { "-" }
pow = { "^" }
exponential = { unary ~ ( pow ~ unary )* }
multiplicative = { exponential ~ ( (mul | div) ~ exponential )* }
mul = { "*" }
div = { "/" }
additive = { multiplicative ~ ( (add | sub) ~ multiplicative )* }
add = { "+" }
sub = { "-" }
expr = _{additive}

assignment = { identifier ~ WHITESPACE* ~ "=" ~ WHITESPACE* ~ expr }

identifier = @{ ASCII_ALPHA ~ (ASCII_ALPHANUMERIC | "_")* }
integer = @{ "-"? ~ ASCII_DIGIT+ }
float = @{ "-"? ~ ASCII_DIGIT+ ~ "." ~ ASCII_DIGIT+ ~ (("e" | "E") ~ ("+" | "-")? ~ ASCII_DIGIT+)? }
number = _{ float | integer }
enclosed = _{ "(" ~ WHITESPACE* ~ expr ~ WHITESPACE* ~ ")" }

comma_separated = _{ WHITESPACE* ~ expr ~ (WHITESPACE* ~ "," ~ WHITESPACE* ~ expr)* ~ WHITESPACE* }
space_separated = _{ WHITESPACE* ~ expr ~ (WHITESPACE+ ~ expr)* ~ WHITESPACE* }

function_call = { identifier ~ "(" ~ WHITESPACE* ~ arguments? ~ WHITESPACE* ~ ")" }
arguments = { comma_separated }

struct_call = { identifier ~ "::" ~ function_call}
instance_field = { identifier ~ "." ~ identifier }
instance_call = { identifier ~ "." ~ function_call}

line = { print_line | silent_line }
silent_line = { print_line ~ ";" }
print_line = { assignment | expr }

elements = { comma_separated }
vector = { "[" ~ WHITESPACE* ~ (elements)? ~ "]" }
matrix_row = { space_separated }
matrix = { "[" ~ matrix_row ~ ( ";" ~ matrix_row )* ~ "]" }